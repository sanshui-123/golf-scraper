# 高尔夫文章处理系统工作流程说明

## 系统概述
本系统用于自动化处理高尔夫文章，包括抓取、改写、格式化和展示功能。

## 核心组件

### 1. 批量处理器 (batch_process_articles.js)
- **功能**：批量处理文章URL，自动抓取内容并调用Claude进行改写
- **主要特性**：
  - 全局去重检测，避免重复处理
  - 并行抓取文章和图片
  - 自动调用Claude API进行内容改写
  - 生成微信公众号格式的HTML
  - 支持一键复制功能

### 2. 文章改写器 (article_rewriter_enhanced.js)
- **功能**：调用Claude API进行文章改写
- **API配置**：使用环境变量 ANTHROPIC_API_KEY
- **改写规则**：根据 golf_rewrite_prompt_turbo.txt 中的提示词

### 3. 图片处理器 (image_processor_final.js)
- **功能**：下载和处理文章中的图片
- **特性**：
  - 自动下载远程图片到本地
  - 生成正确的图片路径
  - 支持批量处理

### 4. 查看服务器 (view_server.js)
- **功能**：提供Web界面查看和管理文章
- **端口**：8080
- **特性**：
  - 两级展开结构（日期→文章列表）
  - 搜索功能
  - 删除功能
  - 查看原文链接

### 5. 启动脚本 (start.js)
- **功能**：命令行启动脚本
- **使用方法**：`node start.js "文章URL"`

## 使用流程

### 1. 处理单篇文章
```bash
node start.js "https://www.golfmonthly.com/news/your-article-url"
```

### 2. 启动查看服务器
```bash
node view_server.js
```
然后访问 http://localhost:8080

### 3. 查看处理结果
- 点击日期展开查看文章列表
- 点击"查看文章"查看Markdown版本
- 点击"微信版"查看可复制到公众号的版本
- 点击"原文"访问原始文章

## 文件结构
```
golf_content/
├── 2025-07-11/                 # 按日期组织
│   ├── articles/               # Markdown文章
│   ├── images/                 # 文章图片
│   ├── wechat_html/           # 微信版HTML
│   ├── wechat_ready/          # 微信版Markdown
│   └── article_urls.json      # URL映射
```

## 关键配置

### 环境变量
- `ANTHROPIC_API_KEY`: Claude API密钥

### 改写提示词 (golf_rewrite_prompt_turbo.txt)
包含详细的改写规则：
- 标题改写要求
- 内容本土化要求
- 图片处理规则
- 文章底部处理规则

## 注意事项

1. **API限制**：Claude API有调用频率限制，批量处理时会自动控制速度
2. **图片路径**：系统会自动处理图片路径，确保在Web界面中正确显示
3. **去重机制**：系统会自动检测已处理的文章，避免重复
4. **错误处理**：失败的文章会记录在 failed_articles.json 中

## 维护建议

1. 定期备份 golf_content 目录
2. 检查 API 使用量，避免超额
3. 定期清理旧的文章和图片
4. 监控服务器运行状态

## 故障排查

### 常见问题

1. **服务器无法访问**
   - 检查端口 8080 是否被占用
   - 使用 `pkill -f "node.*view_server.js"` 停止旧进程

2. **文章处理失败**
   - 检查 API 密钥是否正确
   - 查看 failed_articles.json 了解失败原因
   - 检查网络连接

3. **图片无法显示**
   - 检查图片文件是否存在
   - 确认图片路径是否正确
   - 查看浏览器控制台错误信息