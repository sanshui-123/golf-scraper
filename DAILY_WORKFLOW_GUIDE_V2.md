# 每日高尔夫内容工作流使用指南 v2.0

## 🌟 概述

本工作流提供了完整的高尔夫内容抓取、处理、优化解决方案。v2.0版本新增了自动图片分布优化功能，确保图片位置符合原文逻辑。

## 🚀 一键执行方案（推荐）

```bash
# 全自动执行：扫描 → 处理 → 优化图片
node daily_golf_workflow_v2.js --auto

# 半自动执行：扫描后确认是否处理
node daily_golf_workflow_v2.js
```

## 📋 核心改进

### 1. **图片处理规则升级**
- ✅ 图片必须保持原文相对位置
- ✅ 禁止随意移动图片顺序
- ✅ 自动避免连续图片堆放
- ✅ 每张图片放在对应内容附近

### 2. **工作流程优化**
```
扫描文章 → 批量处理 → 自动优化图片分布 → 生成报告
```

## 📦 工具组件说明

### 核心工作流
- **daily_golf_workflow_v2.js** - 完整工作流（含图片优化）
- **golf_rewrite_prompt.txt** - 更新的改写提示（含图片位置规则）

### 辅助工具
- **fix_all_article_images.js** - 批量修复图片分布
- **optimize_article_images.js** - 单篇文章图片优化

## 💡 使用场景

### 场景1：每日例行处理
```bash
# 每天上午10:30运行
node daily_golf_workflow_v2.js --auto
```

### 场景2：修复历史文章
```bash
# 修复所有文章的图片分布
node fix_all_article_images.js

# 修复指定文章
node fix_all_article_images.js 21 23 24
```

### 场景3：单篇文章处理
```bash
# 处理单篇文章（自动分配编号）
node article_processor_safe_wrapper_v2.js "https://..."

# 优化单篇文章图片
node optimize_article_images.js 23
```

## 📊 处理流程详解

### 步骤1：扫描新文章
- 时间范围：北京时间昨日10点到今日10点
- 自动过滤已处理文章
- 支持多分类扫描

### 步骤2：批量处理
- 自动分配文章编号
- Claude智能改写
- 图片下载和保存

### 步骤3：图片优化（新）
- 检测连续图片问题
- 根据内容重新分布
- 保持原文相对位置

### 步骤4：结果汇总
- 成功/失败统计
- 图片优化报告
- 访问地址生成

## ⚙️ 配置说明

### 时间设置
默认扫描时间可在 `golf_monthly_time_scanner_v2.js` 中调整：
```javascript
// 北京时间每日10点
todayMorning.setHours(10, 0, 0, 0);
```

### 超时设置
- 单篇文章处理：3分钟
- 批量处理间隔：3秒

## 🔧 问题排查

### 图片连续堆放
- 原因：Claude改写时未遵循图片位置规则
- 解决：运行 `node fix_all_article_images.js`

### 处理超时
- 原因：网络问题或Claude响应慢
- 解决：单独重试失败的文章

### 编号冲突
- 原因：手动删除文件导致
- 解决：系统会自动分配新编号

## 📈 最佳实践

1. **定时执行**
   ```bash
   # 添加到crontab
   30 10 * * * cd /path/to/project && node daily_golf_workflow_v2.js --auto
   ```

2. **批量限制**
   - 建议每次处理不超过10篇
   - 大量文章分批处理

3. **结果检查**
   - 处理后访问 http://localhost:8080 查看
   - 检查图片是否正确显示

4. **数据备份**
   - 定期备份 `golf_content` 目录
   - 保存扫描结果供分析

## 🆕 v2.0 新功能

1. **智能图片分布**
   - 自动检测并修复连续图片
   - 确保图片位置符合原文逻辑

2. **增强的错误处理**
   - 更详细的错误信息
   - 失败自动跳过继续

3. **优化的进度显示**
   - 实时显示处理进度
   - 分步骤状态更新

## 📝 更新日志

### v2.0 (2025-07-10)
- ✨ 新增自动图片分布优化
- 📝 更新改写提示词图片规则
- 🔧 创建批量图片修复工具
- 📊 增强处理结果统计

### v1.0 (2025-07-09)
- 🚀 初始版本发布
- 📦 基础扫描和处理功能

---

如有问题，请查看具体工具的 `--help` 参数或查阅源代码注释。